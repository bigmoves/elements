var QS = (function (s) {
  "use strict";
  const n = `
  :host {
    --qs-input-bg: transparent;
    --qs-input-border: #ccc;
    --qs-input-border-focus: #0085ff;
    --qs-input-text: inherit;
    --qs-input-placeholder: #999;
    --qs-menu-bg: #fff;
    --qs-menu-border: #ddd;
    --qs-menu-shadow: rgba(0, 0, 0, 0.15);
    --qs-item-hover: #f3f4f6;
    --qs-avatar-bg: #e5e7eb;
    --qs-handle-color: #111;
    --qs-name-color: #666;
    --qs-radius: 0.375rem;
    --qs-input-padding: 0.5rem 0.75rem;

    display: block;
    position: relative;
    font-family: inherit;
  }

  input {
    width: 100%;
    box-sizing: border-box;
    padding: var(--qs-input-padding);
    font-size: 1rem;
    font-family: inherit;
    border: 1px solid var(--qs-input-border);
    border-radius: var(--qs-radius);
    background: var(--qs-input-bg);
    color: var(--qs-input-text);
  }

  input::placeholder {
    color: var(--qs-input-placeholder);
  }

  input:focus {
    outline: none;
    border-color: var(--qs-input-border-focus);
  }

  input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    margin-top: 4px;
    background: var(--qs-menu-bg);
    border: 1px solid var(--qs-menu-border);
    border-radius: calc(var(--qs-radius) + 2px);
    box-shadow: 0 4px 12px var(--qs-menu-shadow);
    max-height: 240px;
    overflow-y: auto;
    z-index: 100;
    list-style: none;
    padding: 4px;
    margin: 4px 0 0 0;
  }

  .menu:empty {
    display: none;
  }

  .item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    border-radius: var(--qs-radius);
    cursor: pointer;
  }

  .item:hover,
  .item.active {
    background: var(--qs-item-hover);
  }

  .avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--qs-avatar-bg);
    flex-shrink: 0;
    overflow: hidden;
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .handle {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: var(--qs-handle-color);
  }

  .display-name {
    font-size: 0.875rem;
    color: var(--qs-name-color);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .info {
    min-width: 0;
    flex: 1;
  }
`;
  class r extends HTMLElement {
    static formAssociated = !0;
    static get observedAttributes() {
      return [
        "placeholder",
        "debounce",
        "limit",
        "disabled",
        "required",
        "value",
      ];
    }
    #t;
    #e;
    #r;
    #s = [];
    #i = -1;
    #o = null;
    #l = null;
    constructor() {
      (super(),
        (this.#t = this.attachInternals()),
        this.attachShadow({ mode: "open" }));
    }
    connectedCallback() {
      (this.#p(),
        (this.#e = this.shadowRoot.querySelector("input")),
        (this.#r = this.shadowRoot.querySelector(".menu")),
        this.#e.addEventListener("input", this.#v),
        this.#e.addEventListener("keydown", this.#b),
        this.#e.addEventListener("focusout", this.#m),
        this.hasAttribute("value") &&
          ((this.#e.value = this.getAttribute("value")), this.#a()));
    }
    disconnectedCallback() {
      clearTimeout(this.#o);
    }
    attributeChangedCallback(e, t, i) {
      if (this.#e)
        switch (e) {
          case "placeholder":
            this.#e.placeholder = i || "";
            break;
          case "disabled":
            this.#e.disabled = i !== null;
            break;
          case "required":
            ((this.#e.required = i !== null), this.#c());
            break;
          case "value":
            this.#e.value !== i && ((this.#e.value = i || ""), this.#a());
            break;
        }
    }
    get form() {
      return this.#t.form;
    }
    get name() {
      return this.getAttribute("name");
    }
    get type() {
      return this.localName;
    }
    get value() {
      return this.#e?.value || "";
    }
    set value(e) {
      this.#e && ((this.#e.value = e), this.#a());
    }
    get validity() {
      return this.#t.validity;
    }
    get validationMessage() {
      return this.#t.validationMessage;
    }
    get willValidate() {
      return this.#t.willValidate;
    }
    checkValidity() {
      return this.#t.checkValidity();
    }
    reportValidity() {
      return this.#t.reportValidity();
    }
    get actor() {
      return this.#l;
    }
    #p() {
      const e = this.getAttribute("placeholder") || "handle.bsky.social",
        t = this.hasAttribute("disabled"),
        i = this.hasAttribute("required");
      this.shadowRoot.innerHTML = `
      <style>${n}</style>
      <input
        type="text"
        placeholder="${e}"
        autocomplete="off"
        ${t ? "disabled" : ""}
        ${i ? "required" : ""}
      >
      <ul class="menu" role="listbox"></ul>
    `;
    }
    #v = async (e) => {
      const t = e.target.value.trim();
      if (
        ((this.#l = null),
        this.#a(),
        this.dispatchEvent(new Event("input", { bubbles: !0 })),
        clearTimeout(this.#o),
        !t || t.length < 2)
      ) {
        this.#n();
        return;
      }
      const i = parseInt(this.getAttribute("debounce")) || 200;
      this.#o = setTimeout(() => this.#g(t), i);
    };
    #b = (e) => {
      if (this.#s.length !== 0)
        switch (e.key) {
          case "ArrowDown":
            (e.preventDefault(),
              (this.#i = Math.min(this.#i + 1, this.#s.length - 1)),
              this.#d());
            break;
          case "ArrowUp":
            (e.preventDefault(),
              (this.#i = Math.max(this.#i - 1, 0)),
              this.#d());
            break;
          case "Enter":
            this.#i >= 0 && (e.preventDefault(), this.#u(this.#i));
            break;
          case "Escape":
            (e.preventDefault(), this.#n());
            break;
        }
    };
    #m = () => {
      setTimeout(() => this.#n(), 150);
    };
    async #g(e) {
      try {
        const t = parseInt(this.getAttribute("limit")) || 5,
          i = new URL(
            "https://public.api.bsky.app/xrpc/app.bsky.actor.searchActorsTypeahead",
          );
        (i.searchParams.set("q", e), i.searchParams.set("limit", String(t)));
        const a = await fetch(i);
        if (!a.ok) return;
        const o = await a.json();
        ((this.#s = o.actors || []), (this.#i = -1), this.#d());
      } catch (t) {
        console.error("Bluesky handle search failed:", t);
      }
    }
    #d() {
      if (this.#s.length === 0) {
        this.#r.innerHTML = "";
        return;
      }
      ((this.#r.innerHTML = this.#s
        .map(
          (e, t) => `
        <li class="item ${t === this.#i ? "active" : ""}"
            role="option"
            data-index="${t}">
          <div class="avatar">
            ${e.avatar ? `<img src="${this.#h(e.avatar)}" alt="">` : ""}
          </div>
          <div class="info">
            <div class="handle">@${this.#h(e.handle)}</div>
            ${e.displayName ? `<div class="display-name">${this.#h(e.displayName)}</div>` : ""}
          </div>
        </li>
      `,
        )
        .join("")),
        this.#r.querySelectorAll(".item").forEach((e) => {
          e.addEventListener("mousedown", (t) => {
            (t.preventDefault(), this.#u(parseInt(e.dataset.index)));
          });
        }));
    }
    #u(e) {
      const t = this.#s[e];
      t &&
        ((this.#l = t),
        (this.#e.value = t.handle),
        this.#a(),
        this.#n(),
        this.dispatchEvent(new Event("change", { bubbles: !0 })),
        this.dispatchEvent(
          new CustomEvent("qs-select", { bubbles: !0, detail: { actor: t } }),
        ));
    }
    #n() {
      ((this.#s = []), (this.#i = -1), (this.#r.innerHTML = ""));
    }
    #a() {
      const e = this.#e?.value || "";
      (this.#t.setFormValue(e), this.#c());
    }
    #c() {
      const e = this.#e?.value || "";
      this.hasAttribute("required") && !e
        ? this.#t.setValidity(
            { valueMissing: !0 },
            "Please enter a handle",
            this.#e,
          )
        : this.#t.setValidity({});
    }
    #h(e) {
      const t = document.createElement("div");
      return ((t.textContent = e), t.innerHTML);
    }
  }
  return (
    customElements.define("qs-actor-autocomplete", r),
    (s.BskyHandleInput = r),
    Object.defineProperty(s, Symbol.toStringTag, { value: "Module" }),
    s
  );
})({});
